
"use strict";(function(a){if(typeof module==="object"&&typeof module.exports==="object"){a(require("jquery"),window,document)}else{a(jQuery,window,document)}}(function(j,q,z,m){j.fn.orgchart=function(K){var H={nodeTitle:"name",nodeId:"id",toggleSiblingsResp:false,depth:999,chartClass:"",exportButton:false,exportButtonText:"Export",exportFilename:"OrgChart",parentNodeSymbol:"fa-users",draggable:false,direction:"t2b",pan:false,zoom:false};switch(K){case"buildHierarchy":return x.apply(this,Array.prototype.splice.call(arguments,1));case"addChildren":return u.apply(this,Array.prototype.splice.call(arguments,1));case"addParent":return a.apply(this,Array.prototype.splice.call(arguments,1));case"addSiblings":return e.apply(this,Array.prototype.splice.call(arguments,1));case"removeNodes":return A.apply(this,Array.prototype.splice.call(arguments,1));case"getHierarchy":return y.apply(this,Array.prototype.splice.call(arguments,1));case"hideDescendants":return D.apply(this,Array.prototype.splice.call(arguments,1));case"showDescendants":return b.apply(this,Array.prototype.splice.call(arguments,1));case"hideSiblings":return s.apply(this,Array.prototype.splice.call(arguments,1));case"showSiblings":return k.apply(this,Array.prototype.splice.call(arguments,1));case"getNodeState":return E.apply(this,Array.prototype.splice.call(arguments,1));default:var L=j.extend(H,K)}var J=this;var N=L.data;var I=j("<div>",{data:{options:L},"class":"orgchart"+(L.chartClass!==""?" "+L.chartClass:"")+(L.direction!=="t2b"?" "+L.direction:""),click:function(P){if(!j(P.target).closest(".node").length){I.find(".node.focused").removeClass("focused")}}});if(j.type(N)==="object"){if(N instanceof j){x(I,r(N.children()),0,L)}else{x(I,L.ajaxURL?N:v(N,"00"),0,L)}}else{j.ajax({url:N,dataType:"json",beforeSend:function(){I.append('<i class="fa fa-circle-o-notch fa-spin spinner"></i>')}}).done(function(Q,R,P){x(I,L.ajaxURL?Q:v(Q,"00"),0,L)}).fail(function(P,R,Q){console.log(Q)}).always(function(){I.children(".spinner").remove()})}J.append(I);if(L.exportButton&&!J.find(".oc-export-btn").length){var M=j("<button>",{"class":"oc-export-btn"+(L.chartClass!==""?" "+L.chartClass:""),text:L.exportButtonText,click:function(){if(j(this).children(".spinner").length){return false}var R=J.find(".mask");if(!R.length){J.append('<div class="mask"><i class="fa fa-circle-o-notch fa-spin spinner"></i></div>')}else{R.removeClass("hidden")}var Q=J.addClass("canvasContainer").find(".orgchart:visible").get(0);var P=L.direction==="l2r"||L.direction==="r2l";html2canvas(Q,{width:P?Q.clientHeight:Q.clientWidth,height:P?Q.clientWidth:Q.clientHeight,onclone:function(S){j(S).find(".canvasContainer").css("overflow","visible").find(".orgchart:visible:first").css("transform","")},onrendered:function(S){J.find(".mask").addClass("hidden").end().find(".oc-download-btn").attr("href",S.toDataURL())[0].click()}}).then(function(){J.removeClass("canvasContainer")},function(){J.removeClass("canvasContainer")})}});var O='<a class="oc-download-btn'+(L.chartClass!==""?" "+L.chartClass:"")+'" download="'+L.exportFilename+'.png"></a>';J.append(M).append(O)}if(L.pan){J.css("overflow","hidden");I.on("mousedown touchstart",function(W){var V=j(this);if(j(W.target).closest(".node").length||(W.touches&&W.touches.length>1)){V.data("panning",false);return}else{V.css("cursor","move").data("panning",true)}var U=0;var S=0;var T=V.css("transform");if(T!=="none"){var R=T.split(",");if(T.indexOf("3d")===-1){U=parseInt(R[4]);S=parseInt(R[5])}else{U=parseInt(R[12]);S=parseInt(R[13])}}var Q=0;var P=0;if(!W.targetTouches){Q=W.pageX-U;P=W.pageY-S}else{if(W.targetTouches.length===1){Q=W.targetTouches[0].pageX-U;P=W.targetTouches[0].pageY-S}else{if(W.targetTouches.length>1){return}}}I.on("mousemove touchmove",function(aa){if(!V.data("panning")){return}var ab=0;var Z=0;if(!aa.targetTouches){ab=aa.pageX-Q;Z=aa.pageY-P}else{if(aa.targetTouches.length===1){ab=aa.targetTouches[0].pageX-Q;Z=aa.targetTouches[0].pageY-P}else{if(aa.targetTouches.length>1){return}}}var Y=V.css("transform");if(Y==="none"){if(Y.indexOf("3d")===-1){V.css("transform","matrix(1, 0, 0, 1, "+ab+", "+Z+")")}else{V.css("transform","matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+ab+", "+Z+", 0, 1)")}}else{var X=Y.split(",");if(Y.indexOf("3d")===-1){X[4]=" "+ab;X[5]=" "+Z+")"}else{X[12]=" "+ab;X[13]=" "+Z}V.css("transform",X.join(","))}})});j(z).on("mouseup touchend",function(P){if(I.data("panning")){I.data("panning",false).css("cursor","default").off("mousemove")}})}if(L.zoom){J.on("wheel",function(P){P.preventDefault();var Q=1+(P.originalEvent.deltaY>0?-0.2:0.2);F(I,Q)});J.on("touchstart",function(P){if(P.touches&&P.touches.length===2){I.data("pinching",true);var Q=d(P);I.data("pinchDistStart",Q)}});j(z).on("touchmove",function(P){if(I.data("pinching")){var Q=d(P);I.data("pinchDistEnd",Q)}}).on("touchend",function(Q){if(I.data("pinching")){I.data("pinching",false);var P=I.data("pinchDistEnd")-I.data("pinchDistStart");if(P>0){F(I,1.2)}else{if(P<0){F(I,0.8)}}}})}return J};function d(H){return Math.sqrt((H.touches[0].clientX-H.touches[1].clientX)*(H.touches[0].clientX-H.touches[1].clientX)+(H.touches[0].clientY-H.touches[1].clientY)*(H.touches[0].clientY-H.touches[1].clientY))}function F(H,J){var I=H.css("transform");if(I==="none"){H.css("transform","scale("+J+","+J+")")}else{if(I.indexOf("3d")===-1){H.css("transform",I+" scale("+J+","+J+")")}else{H.css("transform",I+" scale3d("+J+","+J+", 1)")}}}function r(I){var H={name:I.contents().eq(0).text().trim(),relationship:(I.parent().parent().is("li")?"1":"0")+(I.siblings("li").length?1:0)+(I.children("ul").length?1:0)};if(I[0].id){H.id=I[0].id}I.children("ul").children().each(function(){if(!H.children){H.children=[]}H.children.push(r(j(this)))});return H}function v(I,H){I.relationship=H+(I.children&&I.children.length>0?1:0);if(I.children){I.children.forEach(function(J){v(J,"1"+(I.children.length>1?1:0))})}return I}function C(I){var J=I.find("tr:first");var H={id:J.find(".node")[0].id};J.siblings(":last").children().each(function(){if(!H.children){H.children=[]}H.children.push(C(j(this)))});return H}function y(H){var H=H||j(this).find(".orgchart");if(!H.find(".node:first")[0].id){return"Error: Nodes of orghcart to be exported must have id attribute!"}return C(H)}function E(I,J){var H={};if(J==="parent"){H=I.closest("table").closest("tr").siblings(":first").find(".node")}else{if(J==="children"){H=I.closest("tr").siblings()}else{H=I.closest("table").parent().siblings()}}if(H.length){if(H.is(":visible")){return{exist:true,visible:true,nodes:H}}return{exist:true,visible:false,nodes:H}}return{exist:false,visible:false,nodes:H}}function n(H){var L=H.closest("table").closest("tr").siblings();if(L.eq(0).find(".spinner").length){H.closest(".orgchart").data("inAjax",false)}if(E(H,"siblings").visible){s(H)}var K=L.slice(1);K.css("visibility","hidden");var J=L.eq(0).find(".node");var I=E(J,"parent").visible;if(J.length&&J.is(":visible")){J.addClass("slide slide-down").one("transitionend",function(){J.removeClass("slide");K.removeAttr("style");L.addClass("hidden")})}if(J.length&&I){n(J)}}function h(H){var J=H.closest("table").closest("tr").siblings().removeClass("hidden");J.eq(2).children().slice(1,-1).addClass("hidden");var I=J.eq(0).find(".node")[0];c(I);j(I).addClass("slide").removeClass("slide-down").one("transitionend",function(){j(I).removeClass("slide");if(l(H)){p(H.children(".topEdge"))}})}function D(I){var L=I.closest("tr").siblings();if(L.last().find(".spinner").length){I.closest(".orgchart").data("inAjax",false)}var H=L.last().find(".node:visible");var J=L.last().is(".verticalNodes")?true:false;if(!J){var K=H.closest("table").closest("tr").prevAll(".lines").css("visibility","hidden")}H.addClass("slide slide-up").eq(0).one("transitionend",function(){H.removeClass("slide");if(J){L.addClass("hidden")}else{K.removeAttr("style").addClass("hidden").siblings(".nodes").addClass("hidden");L.last().find(".verticalNodes").addClass("hidden")}if(l(I)){p(I.children(".bottomEdge"))}})}function b(H){var K=H.closest("tr").siblings();var I=K.is(".verticalNodes")?true:false;var J=I?K.removeClass("hidden").find(".node:visible"):K.removeClass("hidden").eq(2).children().find("tr:first").find(".node:visible");c(J.get(0));J.addClass("slide").removeClass("slide-up").eq(0).one("transitionend",function(){J.removeClass("slide");if(l(H)){p(H.children(".bottomEdge"))}})}function s(I,K){var H=I.closest("table").parent();if(H.siblings().find(".spinner").length){I.closest(".orgchart").data("inAjax",false)}if(K){if(K==="left"){H.prevAll().find(".node:visible").addClass("slide slide-right")}else{H.nextAll().find(".node:visible").addClass("slide slide-left")}}else{H.prevAll().find(".node:visible").addClass("slide slide-right");H.nextAll().find(".node:visible").addClass("slide slide-left")}var J=H.siblings().find(".slide");var L=J.closest(".nodes").prevAll(".lines").css("visibility","hidden");J.eq(0).one("transitionend",function(){L.removeAttr("style");var M=K?(K==="left"?H.prevAll(":not(.hidden)"):H.nextAll(":not(.hidden)")):H.siblings();H.closest(".nodes").prev().children(":not(.hidden)").slice(1,K?M.length*2+1:-1).addClass("hidden");J.removeClass("slide");M.find(".node:visible:gt(0)").removeClass("slide-left slide-right").addClass("slide-up").end().find(".lines, .nodes, .verticalNodes").addClass("hidden").end().addClass("hidden");if(l(I)){i(I)}})}function k(I,L){var K=j();if(L){if(L==="left"){K=I.closest("table").parent().prevAll().removeClass("hidden")}else{K=I.closest("table").parent().nextAll().removeClass("hidden")}}else{K=I.closest("table").parent().siblings().removeClass("hidden")}var H=I.closest("table").closest("tr").siblings();if(L){H.eq(2).children(".hidden").slice(0,K.length*2).removeClass("hidden")}else{H.eq(2).children(".hidden").removeClass("hidden")}if(!E(I,"parent").visible){H.removeClass("hidden");var J=H.find(".node")[0];c(J);j(J).addClass("slide").removeClass("slide-down").one("transitionend",function(){j(this).removeClass("slide")})}K.find(".node:visible").addClass("slide").removeClass("slide-left slide-right").eq(-1).one("transitionend",function(){K.find(".node:visible").removeClass("slide");if(l(I)){i(I);I.children(".topEdge").removeClass("fa-chevron-up").addClass("fa-chevron-down")}})}function f(K,I,J){var H=I.closest(".orgchart");if(typeof H.data("inAjax")!=="undefined"&&H.data("inAjax")===true){return false}K.addClass("hidden");I.append('<i class="fa fa-circle-o-notch fa-spin spinner"></i>');I.children().not(".spinner").css("opacity",0.2);H.data("inAjax",true);j(".oc-export-btn"+(J.chartClass!==""?"."+J.chartClass:"")).prop("disabled",true);return true}function t(K,I,J){var H=I.closest("div.orgchart");K.removeClass("hidden");I.find(".spinner").remove();I.children().removeAttr("style");H.data("inAjax",false);j(".oc-export-btn"+(J.chartClass!==""?"."+J.chartClass:"")).prop("disabled",false)}function l(H){return H.children(".edge").attr("class").indexOf("fa-")>-1?true:false}function p(H){H.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down")}function i(I){var L=I.closest(".orgchart").data("options");if(L.toggleSiblingsResp&&(typeof L.ajaxURL==="undefined"||I.closest(".nodes").data("siblingsLoaded"))){var J=I.closest("table").parent().prev();if(J.length){if(J.is(".hidden")){I.children(".leftEdge").addClass("fa-chevron-left").removeClass("fa-chevron-right")}else{I.children(".leftEdge").addClass("fa-chevron-right").removeClass("fa-chevron-left")}}var M=I.closest("table").parent().next();if(M.length){if(M.is(".hidden")){I.children(".rightEdge").addClass("fa-chevron-right").removeClass("fa-chevron-left")}else{I.children(".rightEdge").addClass("fa-chevron-left").removeClass("fa-chevron-right")}}}else{var K=I.closest("table").parent().siblings();var H=K.length?!K.is(".hidden"):false;I.children(".leftEdge").toggleClass("fa-chevron-right",H).toggleClass("fa-chevron-left",!H);I.children(".rightEdge").toggleClass("fa-chevron-left",H).toggleClass("fa-chevron-right",!H)}}function c(H){if(H){H.style.offsetWidth=H.offsetWidth}}function G(I,M,K){j.each(I.children,function(N,O){O.parentId=I.id});var J=j.Deferred();var L=j("<div"+(K.draggable?' draggable="true"':"")+(I[K.nodeId]?' id="'+I[K.nodeId]+'"':"")+(I.parentId?' data-parent="'+I.parentId+'"':"")+">").addClass("node "+(I.className||"")+(M>=K.depth?" slide-up":"")).append('<div class="title">'+I[K.nodeTitle]+"</div>").append(typeof K.nodeContent!=="undefined"?'<div class="content">'+(I[K.nodeContent]||"")+"</div>":"");var H=I.relationship||"";if(K.verticalDepth&&(M+2)>K.verticalDepth){if((M+1)>=K.verticalDepth&&Number(H.substr(2,1))){L.append('<i class="toggleBtn fa fa-minus-square"></i>')}}else{if(Number(H.substr(0,1))){L.append('<i class="edge verticalEdge topEdge fa"></i>')}if(Number(H.substr(1,1))){L.append('<i class="edge horizontalEdge rightEdge fa"></i><i class="edge horizontalEdge leftEdge fa"></i>')}if(Number(H.substr(2,1))){L.append('<i class="edge verticalEdge bottomEdge fa"></i>').children(".title").prepend('<i class="fa '+K.parentNodeSymbol+' symbol"></i>')}}L.on("mouseenter mouseleave",function(S){var Q=j(this),P=false;var O=Q.children(".topEdge");var T=Q.children(".rightEdge");var N=Q.children(".bottomEdge");var R=Q.children(".leftEdge");if(S.type==="mouseenter"){if(O.length){P=E(Q,"parent").visible;O.toggleClass("fa-chevron-up",!P).toggleClass("fa-chevron-down",P)}if(N.length){P=E(Q,"children").visible;N.toggleClass("fa-chevron-down",!P).toggleClass("fa-chevron-up",P)}if(R.length){i(Q)}}else{Q.children(".edge").removeClass("fa-chevron-up fa-chevron-down fa-chevron-right fa-chevron-left")}});L.on("click",function(N){j(this).closest(".orgchart").find(".focused").removeClass("focused");j(this).addClass("focused")});L.on("click",".topEdge",function(P){P.stopPropagation();var O=j(this);var N=O.parent();var Q=E(N,"parent");if(Q.exist){var R=N.closest("table").closest("tr").siblings(":first").find(".node");if(R.is(".slide")){return}if(Q.visible){n(N);R.one("transitionend",function(){if(l(N)){p(O);i(N)}})}else{h(N)}}else{var S=O.parent()[0].id;if(f(O,N,K)){j.ajax({url:j.isFunction(K.ajaxURL.parent)?K.ajaxURL.parent(I):K.ajaxURL.parent+S,dataType:"json"}).done(function(T){if(N.closest(".orgchart").data("inAjax")){if(!j.isEmptyObject(T)){a.call(N.closest(".orgchart").parent(),N,T,K)}}}).fail(function(){console.log("Failed to get parent node data")}).always(function(){t(O,N,K)})}}});L.on("click",".bottomEdge",function(R){R.stopPropagation();var P=j(this);var O=P.parent();var Q=E(O,"children");if(Q.exist){var N=O.closest("tr").siblings(":last");if(N.find(".node:visible").is(".slide")){return}if(Q.visible){D(O)}else{b(O)}}else{var S=P.parent()[0].id;if(f(P,O,K)){j.ajax({url:j.isFunction(K.ajaxURL.children)?K.ajaxURL.children(I):K.ajaxURL.children+S,dataType:"json"}).done(function(U,V,T){if(O.closest(".orgchart").data("inAjax")){if(U.children.length){u(O,U,j.extend({},K,{depth:0}))}}}).fail(function(T,V,U){console.log("Failed to get children nodes data")}).always(function(){t(P,O,K)})}}});L.on("click",".toggleBtn",function(Q){var R=j(this);var O=R.parent().next();var P=O.find(".node");var N=O.children().children(".node");if(N.is(".slide")){return}R.toggleClass("fa-plus-square fa-minus-square");if(P.eq(0).is(".slide-up")){O.removeClass("hidden");c(N.get(0));N.addClass("slide").removeClass("slide-up").eq(0).one("transitionend",function(){N.removeClass("slide")})}else{P.addClass("slide slide-up").eq(0).one("transitionend",function(){P.removeClass("slide");P.closest("ul").addClass("hidden")}).find(".toggleBtn").removeClass("fa-minus-square").addClass("fa-plus-square")}});L.on("click",".leftEdge, .rightEdge",function(O){O.stopPropagation();var U=j(this);var Q=U.parent();var T=E(Q,"siblings");if(T.exist){var R=Q.closest("table").parent().siblings();if(R.find(".node:visible").is(".slide")){return}if(K.toggleSiblingsResp){var P=Q.closest("table").parent().prev();var V=Q.closest("table").parent().next();if(U.is(".leftEdge")){if(P.is(".hidden")){k(Q,"left")}else{s(Q,"left")}}else{if(V.is(".hidden")){k(Q,"right")}else{s(Q,"right")}}}else{if(T.visible){s(Q)}else{k(Q)}}}else{var S=U.parent()[0].id;var N=(E(Q,"parent").exist)?(j.isFunction(K.ajaxURL.siblings)?K.ajaxURL.siblings(I):K.ajaxURL.siblings+S):(j.isFunction(K.ajaxURL.families)?K.ajaxURL.families(I):K.ajaxURL.families+S);if(f(U,Q,K)){j.ajax({url:N,dataType:"json"}).done(function(X,Y,W){if(Q.closest(".orgchart").data("inAjax")){if(X.siblings||X.children){e(Q,X,K)}}}).fail(function(W,Y,X){console.log("Failed to get sibling nodes data")}).always(function(){t(U,Q,K)})}}});if(K.draggable){L.on("dragstart",function(P){var X=P.originalEvent;var O=/firefox/.test(q.navigator.userAgent.toLowerCase());if(O){X.dataTransfer.setData("text/html","hack for firefox")}if(L.closest(".orgchart").css("transform")!=="none"){var Z,W;if(!z.querySelector(".ghost-node")){Z=z.createElementNS("http://www.w3.org/2000/svg","svg");Z.classList.add("ghost-node");W=z.createElementNS("http://www.w3.org/2000/svg","rect");Z.appendChild(W);L.closest(".orgchart").append(Z)}else{Z=L.closest(".orgchart").children(".ghost-node").get(0);W=j(Z).children().get(0)}var N=L.closest(".orgchart").css("transform").split(",");var T=Math.abs(q.parseFloat((K.direction==="t2b"||K.direction==="b2t")?N[0].slice(N[0].indexOf("(")+1):N[1]));Z.setAttribute("width",L.outerWidth(false));Z.setAttribute("height",L.outerHeight(false));W.setAttribute("x",5*T);W.setAttribute("y",5*T);W.setAttribute("width",120*T);W.setAttribute("height",40*T);W.setAttribute("rx",4*T);W.setAttribute("ry",4*T);W.setAttribute("stroke-width",1*T);var V=X.offsetX*T;var S=X.offsetY*T;if(K.direction==="l2r"){V=X.offsetY*T;S=X.offsetX*T}else{if(K.direction==="r2l"){V=L.outerWidth(false)-X.offsetY*T;S=X.offsetX*T}else{if(K.direction==="b2t"){V=L.outerWidth(false)-X.offsetX*T;S=L.outerHeight(false)-X.offsetY*T}}}if(O){W.setAttribute("fill","rgb(255, 255, 255)");W.setAttribute("stroke","rgb(191, 0, 0)");var Y=z.createElement("img");Y.src="data:image/svg+xml;utf8,"+(new XMLSerializer()).serializeToString(Z);X.dataTransfer.setDragImage(Y,V,S)}else{X.dataTransfer.setDragImage(Z,V,S)}}var U=j(this);var R=U.closest(".nodes").siblings().eq(0).find(".node:first");var Q=U.closest("table").find(".node");U.closest(".orgchart").data("dragged",U).find(".node").each(function(aa,ab){if(Q.index(ab)===-1){if(K.dropCriteria){if(K.dropCriteria(U,R,j(ab))){j(ab).addClass("allowedDrop")}}else{j(ab).addClass("allowedDrop")}}})}).on("dragover",function(O){O.preventDefault();var P=j(this);var Q=P.closest(".orgchart").data("dragged");var N=Q.closest(".nodes").siblings().eq(0).find(".node:first");if(Q.closest("table").find(".node").index(P)>-1||(K.dropCriteria&&!K.dropCriteria(Q,N,P))){O.originalEvent.dataTransfer.dropEffect="none"}}).on("dragend",function(N){j(this).closest(".orgchart").find(".allowedDrop").removeClass("allowedDrop")}).on("drop",function(O){var T=j(this);var U=T.closest(".orgchart");var S=U.data("dragged");U.find(".allowedDrop").removeClass("allowedDrop");var P=S.closest(".nodes").siblings().eq(0).children();if(!T.closest("tr").siblings().length){T.append('<i class="edge verticalEdge bottomEdge fa"></i>').parent().attr("colspan",2).parent().after('<tr class="lines"><td colspan="2"><div class="downLine"></div></td></tr><tr class="lines"><td class="rightLine">&nbsp;</td><td class="leftLine">&nbsp;</td></tr><tr class="nodes"></tr>').siblings(":last").append(S.find(".horizontalEdge").remove().end().closest("table").parent())}else{var R=parseInt(T.parent().attr("colspan"))+2;var W='<i class="edge horizontalEdge rightEdge fa"></i><i class="edge horizontalEdge leftEdge fa"></i>';T.closest("tr").next().addBack().children().attr("colspan",R);if(!S.find(".horizontalEdge").length){S.append(W)}T.closest("tr").siblings().eq(1).children(":last").before('<td class="leftLine topLine">&nbsp;</td><td class="rightLine topLine">&nbsp;</td>').end().next().append(S.closest("table").parent());var V=S.closest("table").parent().siblings().find(".node:first");if(V.length===1){V.append(W)}}var N=parseInt(P.attr("colspan"));if(N>2){P.attr("colspan",N-2).parent().next().children().attr("colspan",N-2).end().next().children().slice(1,3).remove();var Q=P.parent().siblings(".nodes").children().find(".node:first");if(Q.length===1){Q.find(".horizontalEdge").remove()}}else{P.removeAttr("colspan").find(".bottomEdge").remove().end().end().siblings().remove()}U.triggerHandler({type:"nodedropped.orgchart",draggedNode:S,dragZone:P.children(),dropZone:T})})}if(K.createNode){K.createNode(L,I)}J.resolve(L);return J.promise()}function x(Q,L,I,H,U){var R;var P=L.children;var O=P?P.length:false;var K=(H.verticalDepth&&(I+1)>=H.verticalDepth)?true:false;if(Object.keys(L).length>1){R=K?Q:j("<table>");if(!K){Q.append(R)}j.when(G(L,I,H)).done(function(V){if(K){R.append(V)}else{R.append(V.wrap("<tr><td"+(O?' colspan="'+P.length*2+'"':"")+"></td></tr>").closest("tr"))}if(U){U()}}).fail(function(){console.log("Failed to creat node")})}if(O){if(Object.keys(L).length===1){R=Q}var J=I+1>=H.depth?" hidden":"";var N=(H.verticalDepth&&(I+2)>=H.verticalDepth)?true:false;if(!N){R.append('<tr class="lines'+J+'"><td colspan="'+P.length*2+'"><div class="downLine"></div></td></tr>')}var T='<tr class="lines'+J+'"><td class="rightLine">&nbsp;</td>';for(var M=1;M<P.length;M++){T+='<td class="leftLine topLine">&nbsp;</td><td class="rightLine topLine">&nbsp;</td>'}T+='<td class="leftLine">&nbsp;</td></tr>';var S;if(N){S=j("<ul>");if(I+2===H.verticalDepth){R.append('<tr class="verticalNodes"><td></td></tr>').find(".verticalNodes").children().append(S)}else{R.append(S)}}else{S=j('<tr class="nodes'+J+'">');R.append(T).append(S)}j.each(P,function(){var V=N?j("<li>"):j('<td colspan="2">');S.append(V);x(V,this,I+1,H,U)})}}function o(H,I,J,L){var J=J||H.closest(".orgchart").data("options");var K=I.children||I.siblings;H.find("td:first").attr("colspan",K.length*2);x(H,{children:K},0,J,L)}function u(H,K,J){var J=J||H.closest(".orgchart").data("options");var I=0;o.call(H.closest(".orgchart").parent(),H.closest("table"),K,J,function(){if(++I===K.children.length){if(!H.children(".bottomEdge").length){H.append('<i class="edge verticalEdge bottomEdge fa"></i>')}if(!H.find(".symbol").length){H.children(".title").prepend('<i class="fa '+J.parentNodeSymbol+' symbol"></i>')}b(H)}})}function g(J,I,L,M){var K=this;var H=j("<table>");I.relationship="001";j.when(G(I,0,L||J.closest(".orgchart").data("options"))).done(function(P){H.append(P.removeClass("slide-up").addClass("slide-down").wrap('<tr class="hidden"><td colspan="2"></td></tr>').closest("tr"));H.append('<tr class="lines hidden"><td colspan="2"><div class="downLine"></div></td></tr>');var O='<td class="rightLine">&nbsp;</td><td class="leftLine">&nbsp;</td>';H.append('<tr class="lines hidden">'+O+"</tr>");var N=K.children(".orgchart");N.prepend(H).children("table:first").append('<tr class="nodes"><td colspan="2"></td></tr>').children("tr:last").children().append(N.children("table").last());M()}).fail(function(){console.log("Failed to create parent node")})}function a(H,J,I){g.call(this,H,J,I,function(){if(!H.children(".topEdge").length){H.children(".title").after('<i class="edge verticalEdge topEdge fa"></i>')}h(H)})}function w(K,H,J){var I="";for(var L=0;L<J;L++){I+='<td class="leftLine topLine">&nbsp;</td><td class="rightLine topLine">&nbsp;</td>'}K.parent().prevAll("tr:gt(0)").children().attr("colspan",H*2).end().next().children(":first").after(I)}function B(R,I,H,Q){var H=H||R.closest(".orgchart").data("options");var P=I.siblings?I.siblings.length:I.children.length;var K=R.parent().is("td")?R.closest("tr").children().length:1;var J=K+P;var M=(J>1)?Math.floor(J/2-1):0;if(R.parent().is("td")){var O=R.closest("tr").prevAll("tr:last");R.closest("tr").prevAll("tr:lt(2)").remove();var N=0;o.call(R.closest(".orgchart").parent(),R.parent().closest("table"),I,H,function(){if(++N===P){var S=R.parent().closest("table").children("tr:last").children("td");if(K>1){w(S.eq(0).before(R.closest("td").siblings().addBack().unwrap()),J,K);S.addClass("hidden").find(".node").addClass("slide-left")}else{w(S.eq(M).after(R.closest("td").unwrap()),J,1);S.not(":eq("+M+1+")").addClass("hidden").slice(0,M).find(".node").addClass("slide-right").end().end().slice(M).find(".node").addClass("slide-left")}Q()}})}else{var L=0;x(R.closest(".orgchart"),I,0,H,function(){if(++L===J){w(R.next().children("tr:last").children().eq(M).after(j('<td colspan="2">').append(R)),J,1);R.closest("tr").siblings().eq(0).addClass("hidden").find(".node").addClass("slide-down");R.parent().siblings().addClass("hidden").slice(0,M).find(".node").addClass("slide-right").end().end().slice(M).find(".node").addClass("slide-left");Q()}})}}function e(H,J,I){B.call(H.closest(".orgchart").parent(),H.closest("table"),J,I,function(){H.closest(".nodes").data("siblingsLoaded",true);if(!H.children(".leftEdge").length){H.children(".topEdge").after('<i class="edge horizontalEdge rightEdge fa"></i><i class="edge horizontalEdge leftEdge fa"></i>')}k(H)})}function A(H){var J=H.closest("table").parent();var I=J.parent().siblings();if(J.is("td")){if(E(H,"siblings").exist){I.eq(2).children(".topLine:lt(2)").remove();I.eq(":lt(2)").children().attr("colspan",I.eq(2).children().length);J.remove()}else{I.eq(0).children().removeAttr("colspan").find(".bottomEdge").remove().end().end().siblings().remove()}}else{J.add(J.siblings()).remove()}}}));